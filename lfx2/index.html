<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="x5-fullscreen" content="true">
<meta name="full-screen" content="yes">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
<title>陆风X2</title>
<link href="../public/css/reset-h5.css" rel="stylesheet">
<link href="css/main.css?v=123213213" rel="stylesheet">
<!-- 预加载插件 -->
<script type="text/javascript" src="../public/scripts/pace.js"></script>
<!-- css3免前缀插件 -->
<script type="text/javascript" src="../public/scripts/prefixfree.min.js"></script>
<script type="text/javascript" src="../public/scripts/jquery-1.12.1.min.js"></script>
<script type="text/javascript" src="../public/scripts/utils/httpUtil.js"></script>
<script type="text/javascript" src="../public/scripts/utils/validateUtil.js"></script>
<script type="text/javascript" src="js/mmd.videoPlayer.min.js"></script>
</head>
<body ontouchmove="event.preventDefault();">
<!--屏幕兼容代码-->
<script type="text/javascript">

    (function() {
        // deicePixelRatio ：设备像素
        var scale = 1 / devicePixelRatio;
        if(navigator.userAgent.indexOf('iPhone')!=-1){
            //设置meta 压缩界面 模拟设备的高分辨率
            document.querySelector('meta[name="viewport"]').setAttribute('content', 'initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');
        }
        var deviceWidth = document.documentElement.clientWidth > 1300 ? 1300 : document.documentElement.clientWidth;
        //按照640像素下字体为100px的标准来，得到一个字体缩放比例值 6.4
        document.documentElement.style.fontSize = (deviceWidth / 6.4) + 'px'; //320 fontSize = 50px
    })();
</script>
<div id="loading">
    <div class="percent"></div>
    <input type="button" value="click to play" id="player">
</div>
<div class="videos" id="parent">
<!--    <video id="video_1" preload="auto" x5-video-player-fullscreen="true"
          x5-video-player-type="h5"
          x5-video-player-fullscreen="portraint" 
          x-webkit-airplay="true"
          airplay="allow"
          webkit-playsinline="true" 
          playsinline="true"
          src="http://vedio.yunmfang.com/lfx2_part2.mp4">
    </video> -->
       <video id="video_1" 
          x-webkit-airplay="true"
          airplay="allow"
          webkit-playsinline="true" 
          playsinline="true"
          src="http://videooc.tc.qq.com/vcloud1022.tc.qq.com/1022_12b0dfe969e748bcb0b2fd67824808d6.f0.mp4?vkey=96B7D106FB7022A2ECD46C66172DC1954A5FA203F4CC0A7A6157DD1A0E1CACB46E965AA030926A1201D6DF03E68AC76B080E7D83C5E69AAC08FC99B6EF6584BD6DDB8945528DE4DB48ABA2B7A6163D8178A9A3BA80F2D526&sha=0&_d=0.8441714048929574">
    </video>
</div>
<div class="info">
	<img class="logo_I" src="images/logo_I.png" alt="logo-I" />
	<img class="car" src="images/car.png" alt="car"/>
	<div class="info_wrap">
		<img class="logo_II" src="images/logo_II.png" alt="logo-II">
		<div class="info_cont">
			<form>
			  <input type="hidden" name="flag" value="LUFENG_X2" />
			  <div class="form">
			  	<div class="f_row"><div>姓&nbsp;&nbsp;&nbsp;&nbsp;名&nbsp;:</div><div><input type="text" name="name"></div></div>
			  	<div class="f_row"><div>电&nbsp;&nbsp;&nbsp;&nbsp;话&nbsp;:</div><div><input type="text" name="mobile"></div></div>
			  	<div class="f_row location"><div>所在地&nbsp;:</div>
			  		<div>
			  			<select class="s_select" name="province">
			  				<option value="省">省</option>
			  			</select>
			  			<select class="s_select" name="city">
			  				<option value="市">市</option>
			  			</select>
			  		</div>
	  			</div>
			  	<div class="f_row"><div>经销商&nbsp;:</div>
			  		<div>
			  			<select name="dealer">
			  				<option value="经销商">经销商</option>
			  			</select>
			  		</div>
		  		</div>
			  	<div class="f_row ischecked"><div></div>
				  	<div>
				  		<a id="btn_checked" href="javascript:void(0);">
				  			<img src="images/icon_checked.png" alt="checked"><span>允许经销商联系试驾事宜</span>
				  		</a>
			  		</div>
		  		</div>
			  	<div class="f_row submit"><div></div>
			  		<div>
			  			<a id="btn_submit" href="javascript:void(0);" title="">提交</a>
		  			</div>
  				</div>
			  </div>
			</form>
		</div>
	</div>
	<a class="btn_gift">
		<img id="gift" src="images/btn_gift.png"/>
		<p id="gift_w" class="">试驾有礼</p>
	</a>
</div>
</body>
<script type="text/javascript">
	var player = null;
	var STANDARD_WIDTH = 750;
	var STANDARD_HEIGHT = 1206;
	var scale = STANDARD_WIDTH/STANDARD_HEIGHT;
	var provinces,cities,dealers;
    var host = 'http://api.bjczxda.com/api/';
    var http = new Http(host);
    var validate = new InputUtil();
    window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;

    Pace.once('start',function(){
        
        loadInterval = setInterval(function(){
            var load = $('.pace-progress').attr('data-progress-text');
            $('.percent').html(load);
        },100);

        initPageDatas();

        var src = 'http://vedio.yunmfang.com/lfx2_part2.mp4';
        player=new MMD.VideoPlayer(
            document.getElementById('parent'),//video对象的父级div,这样有利于覆盖在video上方的内容对位,诸如loading,落地页等;
            document.getElementById('video_1'),//video对象;
            src,//video地址;
            STANDARD_WIDTH,STANDARD_HEIGHT,//video原始宽高;
            'auto',//内容对齐方式:auto[根据video比例进行判断,铺满全屏,或裁剪高度或裁剪宽度],width[宽度显示完全],height[高度显示完全]
            true//竖屏/横屏:true/false;
    );

  //       player = document.getElementById('video_1');
		// player.addEventListener('ended',function(){
		// 	alert("video is in the end");
		// });
		// multipleDisplayAdapter();
		bindEvents();
    });

    /**
     * 完成加载
     */
    Pace.once('hide', function(e){
    	$('#loading').hide();
	     player.play();
		// if(!videoUtil.isVideoCanAutoPlay){
		// 	$('#player').click();
		// }else{
		// 	$('#loading').hide();
		// 	player.play();
		// }
    });

    
	// window.onload = function(){
		
	// }

	//留资页动画
	function infoPageAnimate(){
		$('.car').addClass('carAnimate');
		$('.logo_II').addClass('fadeInAnimate delay_5h');
		$('.btn_gift').addClass('giftAnimate');
		$('#gift_w').addClass('fadeInAnimate delay_1_5');
		setTimeout(function(){
			requestAnimationFrame(shakeAnimate);
		},2000);
	}

	var start = 0;
	//礼品盒摇动动画
	function shakeAnimate(timestamp){
		if(start==0 || Math.floor((timestamp - start)/1000) == 2) { 
			console.log(start);
			start = timestamp; 
			$('#gift').toggleClass('giftShake');
		}
		requestAnimationFrame(shakeAnimate);
	}


	function initPageDatas(){
		//初始化经销商列表数据
		//并初始化省份下拉列表
		$.getJSON('data.json',function(json){
			provinces = json.provinces;
			cities = json.cities;
			dealers = json.dealers;

			$('select[name="province"]').empty();
			var option = '<option value="省">省</option>';
			for(var i = 0; i < provinces.length; i++){
				var p = provinces[i];
				option += '<option value="'+ p.province +'">'+ p.province +'</option>';
			}
			$('select[name="province"]').html(option);
		});
	}

	function bindEvents(){
		
		$('#player').click(function(){
			player.play();
			$('#loading').hide();
			// alert(videoUtil.isVideoCanAutoPlay);
		});

		//省、市、经销商三级联动
		$('select[name="province"]').on('change',function(){
			var selected = $(this).val();
			$('select[name="city"]').empty();
            $('select[name="city"]').html('<option value"市">市</option>');
            $('select[name="dealer"]').empty();
            $('select[name="dealer"]').html('<option value"经销商">经销商</option>');
			 if(selected !='省'){
                  for(var i = 0; i < cities.length; i++){
                  	   var city = cities[i];
                      if(city.province == $(this).val())
                          $('select[name="city"]').append('<option value="'+ city.city +'">'+ city.city +'</option>');
                  }
            }
		});
		//市、经销商二级联动
		$('select[name="city"]').on('change',function(){
			var selected = $(this).val();
		 	
		 	$('select[name="dealer"]').empty();
		  	$('select[name="dealer"]').append('<option value"经销商">经销商</option>');
			
			if(selected !='市'){
                  for(var i = 0; i < dealers.length; i++){
                  	   var dealer = dealers[i];
                      if(dealer.city == $(this).val())
                          $('select[name="dealer"]').append('<option value="'+ dealer.dealer +'">'+ dealer.dealer +'</option>');
                  }
            }
		});

		$('#btn_checked').click(function(){
			if(isChecked())
				$($(this).find('img:first')).attr('src','images/icon_un_checked.png');
			else
				$($(this).find('img:first')).attr('src','images/icon_checked.png');
		});

		$('#btn_submit').click(function(){

			var params = $('form:first').serialize();
            var name = $('input[name="name"]').val();
            var mobile = $('input[name="mobile"]').val();
            var province = $('select[name="province"]').val();
            var city = $('select[name="city"]').val();
            var dealer = $('select[name="dealer"]').val();
            var allow = isChecked()? 1 : 0;

            if(validate.isEmpty(name)){
                alert('姓名不能为空');
                return false;
            }
            if(validate.isEmpty(mobile)){
                alert('手机号不能为空');
                return false;
            }
            if(!validate.isMobile(mobile)){
                alert('请输入手机号');
                return false;
            }
            if(province == '省'){
                alert('请选择省');
                return false;
            }
            if(city == '市'){
                alert('请选择市');
                return false;
            }
            if(dealer == '经销商'){
                alert('请选择经销商');
                return false;
            }

            http.ajaxRequest({
                type:'POST',
                uri:'h5/insertLFX2?' + params + '&allow='+allow,
                success:function(json){
                    var data = json.data;
                    if(json.success){
                    	var winner = (parseInt(data.client_sex) == NaN || parseInt(data.client_sex) == 0)? false : true;
                    	alert(winner ? '留资成功，你获得京东100元电子购物卡':'留资成功');
                    }else{
                    	alert('重复留资!');
                    }
                },
                error:function(e){
                    if(e.responseJSON){
                        alert(e.responseJSON.message);
                    }else
                        alert('您已参加活动');
                }
            });
		});
	}


	//判断是否允许经销商联系
	//true 允许， false 不允许
	function isChecked(){
		return $($('#btn_checked').find('img:first')).attr('src').indexOf('un') == -1;
	}

	/**
	 * [multipleDisplayAdapter description]
	 * 基于iphone 6屏幕分辨率375 * 603 进行全屏适配算法
	 * @return 
	 */
	function multipleDisplayAdapter(){
		var videos = document.getElementsByTagName('video');
		var bodyW = document.body.clientWidth;
		var bodyH = document.body.clientHeight;
	 	var height = bodyW/scale;
		for(var i =0; i < videos.length; i++){
			var video = videos[i];
			if(height >= bodyH){
	            video.style.width = bodyW + 'px';
	            video.style.top = (bodyH-height) + 'px';
	        }else {
	            video.style.height = bodyH + 'px';
	            video.style.left = (bodyW - scale * bodyH)/2 + 'px';
	        }
		}
	}
</script>
<!-- 微信分享api -->
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<!-- <script type="text/javascript" src="js/wx_share.js"></script> -->
</html>