<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>微信语音录制</title>
    <style type="text/css">
        button {
            margin-right: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <button onclick="javascript:wxVideoPlayer.startRecord();">开始录制</button>
    <button onclick="javascript:wxVideoPlayer.stopRecord();">停止录制</button>

    <button onclick="javascript:wxVideoPlayer.playVoice();">播放录音</button>
    <button onclick="javascript:wxVideoPlayer.pauseVoice();">暂停录音</button>
    <button onclick="javascript:wxVideoPlayer.stopVoice();">停止录音</button>
    <button onclick="javascript:wxVideoPlayer.translateVoice();">转义语音</button>

    <p>转义结果：</p>
    <p id="result">暂无结果</p>

    <script type="text/javascript" src="../public/scripts/jquery-1.12.1.min.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script type="text/javascript" src="js/wx_share.js?v20170418"></script>
    <script type="text/javascript">

        var gLocalId = -1;
        let wxVideoPlayer = {
            init: function () {

            },
            startRecord: function () {
                alert("开始录音");
                wx.startRecord();
                wx.onVoiceRecordEnd({
                    // 录音时间超过一分钟没有停止的时候会执行 complete 回调
                    complete: function (res) {
                        gLocalId = res.localId;
                        alert(gLocalId);
                    }
                });
            },
            stopRecord: function () {
                wx.stopRecord({
                    success: function (res) {
                        gLocalId = res.localId;
                        alert("停止录音");
                    }
                });
            },
            playVoice: function () {
                alert("播放音频："+gLocalId);
                wx.playVoice({
                    localId: gLocalId // 需要播放的音频的本地ID，由stopRecord接口获得
                });

                wx.onVoicePlayEnd({
                    success: function (res) {
                        gLocalId = res.localId; // 返回音频的本地ID
                        alert("播放录音");
                    }
                });
            },
            pauseVoice: function pauseVoice() {
                wx.pauseVoice({
                    localId: gLocalId // 需要暂停的音频的本地ID，由stopRecord接口获得
                });
                alert("暂停播放");
            },
            stopVoice: function () {
                wx.stopVoice({
                    localId: gLocalId // 需要停止的音频的本地ID，由stopRecord接口获得
                });
                alert("停止播放");
            },
            translateVoice: function translateVoice() {
                wx.translateVoice({
                    localId: gLocalId, // 需要识别的音频的本地Id，由录音相关接口获得
                    isShowProgressTips: 1, // 默认为1，显示进度提示
                    success: function (res) {
                        alert(res.translateResult); // 语音识别的结果
                        $('#result').html(res.translateResult);
                    }
                });
            }

        };
        wxVideoPlayer.init();
        
    </script>
</body>
</html>