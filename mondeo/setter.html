<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>蒙迪欧页面参数设置</title>
    <script type="text/javascript" src="../public/scripts/jquery-1.12.1.min.js"></script>
    <script type="text/javascript" src="../public/scripts/utils/httpUtil.js"></script>
    <script type="text/javascript" src="../public/scripts/utils/commentUtil.js"></script>
</head>
<style>
    label { font-size: 16px;}
    .clear{  clear: both;  }
    .row label{ float: left; }
    .row div:nth-child(2) { float: left; text-align: left;border-bottom: 1px solid black;height: 17px; width: 150px;}
</style>
<body>
<div>
    <p style="color: red">蒙迪欧直播数据</p>
    <div class="row">
       <label>人气数:</label><div id="lives"></div>
        <div class="clear"></div>
    </div>
    <div class="row">
        <label>同时在线人数:</label><div id="audiences"></div>
        <div class="clear"></div>
    </div>
    <input type="button" id="resetRedis" value="清空直播人气数据"/>
</div>
<div>
    <p style="color: red">蒙迪欧直播跑圈数据</p>
    <form>
        <div>
           <label>三环：</label><input type="text" id="tricyclic_turns" name="tricyclic_turns"/>
        </div>
        <div>
            <label>四环：</label><input type="text" id="tetracyclic_turns" name="tetracyclic_turns" />
        </div>
            <label>五环：</label><input type="text" id="pentacyclic_turns" name="pentacyclic_turns" />
        <div>
            <label>三环已使用油量：</label><input type="text" id="used_gasoline" name="used_gasoline" />
        </div>
        <div>
            <label>四环已使用油量：</label><input type="text" id="used_gasonline_tera" name="used_gasonline_tera" />
        </div>
        <div>
            <label>五环已使用油量：</label><input type="text" id="used_gasonline_penta" name="used_gasonline_penta" />
        </div>
        <div>
            <label>总耗时：</label><input type="text" id="used_time_tri" name="used_time_tri" />
        </div>
        <div>
            <label>活动状态：</label><input type="radio" name="active_state" value="0" checked="checked" />未开始<input type="radio" name="active_state" value="1" />进行中<input type="radio" name="active_state" value="2" />已结束
        </div>
        <!--<div>-->
            <!--<label>四环总耗时：</label><input type="text" id="used_time_tera" name="used_time_tera" />-->
        <!--</div>-->
        <!--<div>-->
            <!--<label>五环总耗时：</label><input type="text" id="used_time_penta" name="used_time_penta" />-->
        <!--</div>-->
    </form>
    <div>
     <input type="button" id="submit" value="提交挑战数据" /><input type="button" id="resetMondeoProps" value="重置挑战数据" />
    </div>
</div>
<div>
    <div class="table_row marginTop"><p><img style="width:.45rem;" name="img_province"><span>省份</span></p>
        <select id="province" name="province" data-action="changeProvince"><option>请选择</option></select>
    </div>
    <div class="table_row marginTop"><p><img style="width:.65rem;" name="img_city"><span>城市</span></p>
        <select id="city" name="city" data-action="changeCity"><option>请选择</option></select>
    </div>
    <div class="table_row marginTop"><p><img style="width:.755rem;" name="img_dealer"><span>经销商</span></p>
        <select id="dealer" name="dealer"><option>请选择</option></select>
    </div>
</div>
</body>
<script type="text/javascript">
    var http;
    var host = 'http://api.bjczxda.com/api/';
//    var host = 'http://localhost:9090/api/';
    var provinces;
    var cities;
    var dealers;

    window.onload = function(){
        http = new Http(host);
        http.ajaxRequest({type:'GET',uri:'h5/getInitDatas?flag=MONDEO_20170501',success:function(json){
            var data = json.data;
            $('#lives').html(data.lives ? data.lives : 0);
            $('#audiences').html(data.audiences ? data.audiences : 0);
            $('#used_time_tri').val(data.used_time_tri);
//            $('#used_time_tera').val(data.used_time_tera);
//            $('#used_time_penta').val(data.used_time_penta);
            $('#tricyclic_turns').val(data.tricyclic_turns);
            $('#tetracyclic_turns').val(data.tetracyclic_turns);
            $('#pentacyclic_turns').val(data.pentacyclic_turns);
            $('#used_gasoline').val(data.used_gasoline);
            $('#used_gasonline_tera').val(data.used_gasonline_tera);
            $('#used_gasonline_penta').val(data.used_gasonline_penta);

            var state = parseInt(data.active_state);
            var doms = $('input[type="radio"]');
            $(doms[state]).attr('checked','checked');
        }});

        $.getJSON("datas/data.json",function(data){
            provinces = data.province;
            cities = data.city;
            dealers = data.dealer;
            for(var i = 0; i < provinces.length; i ++)
                $('#province').append('<option>'+provinces[i].p+'</option>');
        });
    }

    $('#province').on('change',function(e){
        $('#city').empty();
        $('#city').html('<option>请选择</option>');
        $('#dealer').empty();
        $('#dealer').html('<option>请选择</option>');

        if($('#province').val() != '请选择'){
            for(var j = 0; j < cities.length; j++)
                if(cities[j].p == $('#province').val())
                    $('#city').append('<option>'+cities[j].c+'</option>');
        }
    });

    $('#city').on('change',function(e){
        $('#dealer').empty();
        $('#dealer').html('<option>请选择</option>');

        if($('#city').val() != '请选择'){
            for(var j = 0; j < dealers.length; j++)
                if(dealers[j].c == $('#city').val())
                    $('#dealer').append('<option>'+dealers[j].d +'</option>');

        }
    });

    $('#resetRedis').on('click',function(e){
        var flag = confirm("是否清空蒙迪欧直播人气数，同时在线人数?");
        if(flag){
            http.ajaxRequest({type:'GET',uri:'h5/resetRedisDatas?flag=MONDEO_20170501',success:function(json){
                var data = json.data;
                $('#lives').html(0);
                $('#audiences').html(0);
                alert('已清空直播人气数!');
            }});
        }
    });

    $('#submit').on('click',function(e){
        var params = $('form').serialize();
        http.ajaxRequest({type:'GET',uri:'h5/updateMondeoProps?' + params + '&flag=MONDEO_20170501',success:function(json){
            var data = json.data;
            $('#used_time_tri').val(data.used_time_tri);
//            $('#used_time_tera').val(data.used_time_tera);
//            $('#used_time_penta').val(data.used_time_penta);
            $('#tricyclic_turns').val(data.tricyclic_turns);
            $('#tetracyclic_turns').val(data.tetracyclic_turns);
            $('#pentacyclic_turns').val(data.pentacyclic_turns);
            $('#used_gasoline').val(data.used_gasoline);
            $('#used_gasonline_tera').val(data.used_gasonline_tera);
            $('#used_gasonline_penta').val(data.used_gasonline_penta);
            alert('设置数据成功');
        }});
    });

    $('#resetMondeoProps').on('click',function(e){
        var flag = confirm("是重置空蒙迪欧挑战数据?");

        if(flag){
            http.ajaxRequest({type:'GET',uri:'h5/updateMondeoProps?reset=1',success:function(json){
                var data = json.data;
                $('#used_time_tri').val(data.used_time_tri);
//                $('#used_time_tera').val(data.used_time_tera);
//                $('#used_time_penta').val(data.used_time_penta);
                $('#tricyclic_turns').val(data.tricyclic_turns);
                $('#tetracyclic_turns').val(data.tetracyclic_turns);
                $('#pentacyclic_turns').val(data.pentacyclic_turns);
                $('#used_gasoline').val(data.used_gasoline);
                $('#used_gasonline_tera').val(data.used_gasonline_tera);
                $('#used_gasonline_penta').val(data.used_gasonline_penta);
                alert('重置蒙迪欧挑战数据成功');
            }});
        }
    });
</script>
</html>